// #include "libfixmath/fix16_exp.c"
// #include "libfixmath/fix16.c"    
#include "rnn_fixed.h"
#include "rnn_weights.h"
#include "main.h"

int main()
{
    RNN_F temp;
    RNN_F * rnn = &temp;

    int num_layers = 3;
    int layers[3] = {4, 4, 4};
    int loss = 0;
    int bias = 1;
    int activation[2] = {1, 0};

    fix16_t input_set[4][4] = {
        {0, 0, 65536, 0},   // H
        {0, 0, 0, 65536},   // E
        {0, 65536, 0, 0},   // L
        {0, 65536, 0, 0}    // L
    };
    fix16_t output_set[4][4];
    
    fix16_t expected[4][4] = {        // outputs
        {0, 0, 0, 65536},   // E
        {0, 65536, 0, 0},   // L
        {0, 65536, 0, 0},   // L
        {65536, 0, 0, 0}    // O
    };

    // fix16_t input_set[9][5] = {   // inputs
    //     {0, 0, 65536, 0, 0},   // 0
    //     {0, 65536, 0, 0, 0},   // 1
    //     {65536, 0, 0, 0, 0},   // 2
    //     {0, 65536, 0, 0, 0},   // 1
    //     {0, 0, 65536, 0, 0},   // 0
    //     {0, 0, 0, 65536, 0},   // -1
    //     {0, 0, 0, 0, 65536},   // -2
    //     {0, 0, 0, 65536, 0},   // -1
    //     {0, 0, 65536, 0, 0}    // 0
    // };
    // fix16_t output_set[9][5];
    // fix16_t expected[9][5] = {        // outputs
    //     {0, 65536, 0, 0, 0},  // 1
    //     {65536, 0, 0, 0, 0},  // 2
    //     {0, 65536, 0, 0, 0},  // 1
    //     {0, 0, 65536, 0, 0},  // 0
    //     {0, 0, 0, 65536, 0},  // -1
    //     {0, 0, 0, 0, 65536},  // -2
    //     {0, 0, 0, 65536, 0},  // -1
    //     {0, 0, 65536, 0, 0},  // 0
    //     {0, 65536, 0, 0, 0}   // 1
    // };

    rnn_init_fixed_custom(rnn, num_layers, layers, weights, loss, bias, activation); 
    rnn_run_sequence(4, input_set, output_set, rnn);

    for(int i = 0; i < 4; i++)
    {
        printf("Set %d:\n", i);
        printf("->  Expected: ");
        for(int j = 0; j < 4; j++)
        {
            printf("%d ", expected[i][j]);
        }
        printf("\n");
        printf("->  Predicted: ");
        for(int j = 0; j < 4; j++)
        {
            printf("%d ", output_set[i][j]);
        }
        printf("\n");
    }

    // printf("[%d, %d]    %d  %d  [%d, %d, %d]\n", rnn->activation[0], rnn->activation[1], rnn->bias, rnn->num_layers, rnn->layers[0], rnn->layers[0], rnn->layers[0]);

    // fix16_t input_set[4][4] = {
    //     {0, 0, 65536, 0},   // H
    //     {0, 0, 0, 65536},   // E
    //     {0, 65536, 0, 0},   // L
    //     {0, 65536, 0, 0}    // L
    // };
    // fix16_t output_set[4][4];
    
    // fix16_t expected[4][4] = {        // outputs
    //     {0, 0, 0, 65536},   // E
    //     {0, 65536, 0, 0},   // L
    //     {0, 65536, 0, 0},   // L
    //     {65536, 0, 0, 0}    // O
    // };

    // float weight conversion
    // float temp_weights[3][30] = {
    // {-1.18227960713629, -0.050406777246716751, -0.43784300573552487, -0.032225322891170825, 0.62677460593975587, -0.66457858811532444, 0.53097674629676528, -0.89717523549415923, 0.49682760145013, 0.095324089238253501, -0.82887445238719604, 1.1241309358222689, -1.2584310296622128, 1.0876489548925279, -0.32686341629229831, -2.0398947175721185, 1.5235500416823526, -1.5571784210407322, 0.99512503626371984, 1.156515080879055, 0.049582413776118502, -1.4562511847232043, 0.78210456569700348, 1.5177485561814372, -0.82536426712694178, -0.51055396276373066, -0.731751677921471, -0.89173075264153168, -0.20798025958049488, 0.018711552070764827},
    // {-0.96154976996940811, -1.2802409950390405, 0.51266460286752391, 0.81306399130184825, -0.64638127172964377, -0.42262082325347716, -1.0014864381175628, -1.1274320595500584, -1.7342541117919148, 0.25989543265837595, -0.26789790008163167, 1.2365966933305075, 0.93910916498482233, 0.25471458327020474, -1.3871923734509626, 1.1347851406222571, -0.6544621417563552, -1.0587962487675033, 0.53880346498847764, -0.92454415087800912, -0.41612006716158678, 0.81497400855875746, 0.81290129348519746, 0.72392076046574672, 1.4134599017389147, 0.069729286918386257, 0.92997823878645713, 0.40188225235180464, 0.479048620767422, 0.41807311929654045},
    // {0.11079228587408047, 0.84709351339519223, 0.18325720611388702, 1.339348223891794, -0.032550209427629026, 0.57871675565244818, 0.43437248902796077, -1.2164841075979298, 0.29749010938768777, -2.0249752652913338, -0.16389699157060419, -0.29695612376977376, -1.224717074223167, 0.0043340910917610961, -0.45077303273406222, -1.5747081730817041, 1.1993512835355926, -1.1086327104755129, 0.42584195115905049, -0.57038378401035472, 1.8509994770668747, 2.5580938217928595, -0.56003953245699922, -2.6188941756457389, -0.39616362854552389}
    // };

    // int lay[3] = {30, 30, 25};

    // for(int i = 0; i < 3; i++)
    // {
    //     for(int j = 0; j < lay[i]; j++)
    //     {
    //         printf("%d, ", fix16_from_float(temp_weights[i][j]));
    //     }
    //     printf("\n");
    // }
    
    return 0;
}